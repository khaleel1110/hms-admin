
<main id="content" role="main" class="main" style="min-height: 88vh">
  <div class="content container px-6">
    <div class="mb-4">
      <div class="row align-items-center">
        <div class="col-sm mb-2 mb-sm-0">
          <h1 class="page-header-title">Bookings List</h1>
          <p>View and manage all your bookings</p>
        </div>
        <div class="col-sm-auto">
          <a routerLink="/admin/add-booking" routerLinkActive="active" class="btn btn-outline-primary">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="20"
              fill="currentColor"
              class="bi bi-person-add"
              viewBox="0 0 16 16"
            >
              <path
                d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"
              />
              <path
                d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"
              />
            </svg>
            <span class="m-2">Add Booking</span>
          </a>
        </div>
      </div>
    </div>



    <div class="card shadow-none p-3">
      <div class="card-header card-header-content-md-between">
        <div class="col-sm-auto m-3">
          <form (ngSubmit)="onSearch()">
            <div class="input-group input-group-merge input-group-flush">
              <div class="input-group-prepend input-group-text">
                <i class="bi bi-search"></i>
              </div>
              <input
                id="datatableSearch"
                type="search"
                class="form-control"
                placeholder="Search bookings"
                aria-label="Search bookings"
                [(ngModel)]="searchTerm"
                name="searchTerm"
              />
              <button type="submit" class="btn btn-outline-primary">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="currentColor"
                  class="bi bi-search"
                  viewBox="0 0 16 16"
                >
                  <path
                    d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"
                  />
                </svg>
                Search
              </button>
            </div>
          </form>
          <div *ngIf="selectedCount > 0" class="mt-3">
            <strong>{{ selectedCount }}</strong> Booking(s) selected.
          </div>
        </div>
        <div class="d-grid d-sm-flex justify-content-md-end align-items-sm-center gap-2">
          <!-- Export Dropdown -->
          <div class="dropdown" ngbDropdown #dropLearning="ngbDropdown">
            <button
              class="btn btn-white btn-sm w-100 dropdown-toggle"
              ngbDropdownAnchor
              (focus)="dropLearning.open()"
              role="button"
              id="usersExportDropdown"
              aria-expanded="false"
            >
              <i class="bi-download me-2"></i> Export
            </button>
            <div
              class="dropdown-menu dropdown-menu-sm-end"
              ngbDropdownMenu
              aria-labelledby="usersExportDropdown"
            >
              <div class="dropdown-divider"></div>
              <span class="dropdown-header">Download options</span>

              <a
                (click)="onGenerateExcel()"
                [class.disabled]="isLoading()"
                id="export-excel"
                class="dropdown-item"
                ngbDropdownItem
              >
                <img
                  class="avatar avatar-xss avatar-4x3 me-2"
                  src="/assets/svg/brands/excel-icon.svg"
                  alt="Excel Icon"
                />
                Excel
              </a>

              <a
                (click)="exportAsPdf()"
                [class.disabled]="isLoading()"
                id="export-pdf"
                class="dropdown-item"
                ngbDropdownItem
              >
                <img
                  class="avatar avatar-xss avatar-4x3 me-2"
                  src="/assets/svg/brands/pdf-icon.svg"
                  alt="PDF Icon"
                />
                PDF
              </a>
            </div>

          </div>

          <!-- Filter Dropdown -->
          <!-- Inside the filter dropdown form -->
          <div class="dropdown  " ngbDropdown #filterDropdown="ngbDropdown">
            <button
              class="btn btn-outline-primary btn-sm w-100 dropdown-toggle"
              ngbDropdownAnchor
              (focus)="filterDropdown.open()"
              id="filterDropdownButton"
              aria-expanded="false"
            >
              <i class="bi-funnel me-2"></i> Filter Patients
            </button>

            <div
              class="dropdown-menu w-100 p-3"
              style="max-width: 100%; min-width: 300px;"
              ngbDropdownMenu
              aria-labelledby="filterDropdownButton"
            >
              <form #filterForm="ngForm" (ngSubmit)="applyFilters()">
                <span class="dropdown-header text-uppercase mb-2 text-muted small">Date Range</span>
                <div class="row mb-3">
                  <div class="col-sm-6 mb-2">
                    <label for="startDate" class="form-label">Start Date</label>
                    <input
                      type="date"
                      class="form-control form-control-sm"
                      id="startDate"
                      name="startDate"
                      [(ngModel)]="filters.startDate"
                    />
                  </div>
                  <div class="col-sm-6 mb-2">
                    <label for="endDate" class="form-label">End Date</label>
                    <input
                      type="date"
                      class="form-control form-control-sm"
                      id="endDate"
                      name="endDate"
                      [(ngModel)]="filters.endDate"
                    />
                  </div>
                </div>

                <!-- Add other filters here if needed -->
                <!-- Example: Role, Status, Location, etc. -->

                <div class="d-grid mt-3">
                  <button type="submit" class="btn btn-primary btn-sm">
                    <i class="bi-funnel-fill me-1"></i> Apply Filters
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- End Filter Dropdown -->
        </div>
      </div>


      <div class="table-responsive datatable-custom position-relative">
        <div *ngIf="isLoading()" class="text-center p-4">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>

        <table
          *ngIf="!isLoading()"
          class="table table-lg table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
          data-hs-datatables-options='{
            "columnDefs": [{
              "targets": [0, 8],
              "orderable": false
            }],
            "order": [],
            "info": {
              "totalQty": "#datatableWithPaginationInfoTotalQty"
            },
            "search": "#datatableSearch",
            "entries": "#datatableEntries",
            "pageLength": 15,
            "isResponsive": false,
            "isShowPaging": false,
            "pagination": "datatablePagination"
          }'
        >
          <thead class="thead-light">
          <tr>
            <th class="table-column-pe-0">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value=""
                  id="datatableCheckAll"
                  (change)="selectAll($event)"
                />
                <label class="form-check-label" for="datatableCheckAll"></label>
              </div>
            </th>
            <th scope="col"><strong class="h4">S/N</strong></th>
            <th scope="col"><strong class="h4">Patient Name</strong></th>
            <th scope="col"><strong class="h4">Doctor</strong></th>
            <th scope="col"><strong class="h4">Phone</strong></th>
            <th scope="col"><strong class="h4">Appointment Type</strong></th>
            <th scope="col"><strong class="h4">Time</strong></th>
            <th scope="col"><strong class="h4">Edit</strong></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let booking of bookingsItems; let i = index">
            <td class="table-column-pe-0">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value=""
                  [checked]="isSelected(booking.id)"
                  (change)="toggleSelection(booking.id)"
                />
                <label class="form-check-label" for="datatableCheckAll{{i}}"></label>
              </div>
            </td>
            <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
            <td class="table-column-ps-0">
              <a class="d-flex align-items-center" >
                <div class="avatar avatar-soft-dark avatar-circle">
              <span class="avatar-initials">{{
                  booking.name
                    ? booking.email.substring(0, 2).toUpperCase()
                    : 'UN'
                }}</span>
                </div>
                <div class="ms-3">
                  <span class="d-block h5 text-inherit mb-0">{{ booking.name }}</span>
                  <span class="d-block fs-5 text-body">{{ booking.email || 'N/A' }}</span>
                </div>
              </a>
            </td>
            <td>dr.{{ booking.doctorName }}</td>
            <td>{{ booking.phone }}</td>
            <td>{{ booking.appointmentType }}</td>
            <td>{{ booking.startTime | date: 'shortTime' }} - {{ booking.endTime | date: 'shortTime' }}</td>
            <td>
              <a
                [routerLink]="['/admin/view-booking', booking.id]"
                routerLinkActive="active"
                class="btn btn-sm btn-outline-primary"
              >
              Edit
              </a>
            </td>
          </tr>
          </tbody>
        </table>
      </div>


    </div>
    <div class="p-4">
      <app-pagination
        [totalItems]="bookings().length"
        [itemsPerPage]="itemsPerPage"
        [currentPage]="currentPage"
        (pageChange)="onPageChange($event)"
      ></app-pagination>
    </div>
  </div>
</main>

